2024-10-20 07:06:40 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_28'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 07:06:40 - INFO - Starting scenario data retrieval.
2024-10-20 07:06:40 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:06:40 - INFO - Fetching scenario configuration data
2024-10-20 07:06:47 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_28')
        
2024-10-20 07:06:48 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 07:06:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:06:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:06:58 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 07:06:58 - INFO - Starting customer ID retrieval.
2024-10-20 07:06:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:07:10 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 07:07:10 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 07:07:10 - INFO - Starting threshold data retrieval.
2024-10-20 07:07:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:07:10 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 07:07:10 - INFO - Fetching threshold configuration data.
2024-10-20 07:07:10 - DEBUG - Processing scenario ID: TS_SCN_28
2024-10-20 07:07:10 - DEBUG - Executing SQL query for scenario ID TS_SCN_28: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_28'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:07:14 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_28'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:07:14 - INFO - Threshold data fetching completed successfully.
2024-10-20 07:07:14 - INFO - Starting customer ID processing.
2024-10-20 07:07:14 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 07:07:19 - INFO - Spark session initialized successfully.
2024-10-20 07:07:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:07:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:07:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:07:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:07:49 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 07:07:49 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:07:54 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 07:07:54 - INFO - Fetching transaction data for 1 customers.
2024-10-20 07:07:57 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 07:08:29 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 07:08:48 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 07:09:00 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:09:00 - INFO - All customer chunks processed.
2024-10-20 07:09:00 - INFO - Spark session stopped.
2024-10-20 07:09:00 - INFO - Starting Parquet files processing.
2024-10-20 07:09:00 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 07:09:00 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:09:01 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 07:09:01 - ERROR - Error applying scenario config conditions to DataFrame: name 'TS_TRXN' is not defined
2024-10-20 07:09:01 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet: name 'TS_TRXN' is not defined
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 231, in resolve
    return self.resolvers[key]
  File "/usr/lib/python3.10/collections/__init__.py", line 986, in __getitem__
    return self.__missing__(key)            # support subclasses that define __missing__
  File "/usr/lib/python3.10/collections/__init__.py", line 978, in __missing__
    raise KeyError(key)
KeyError: 'TS_TRXN'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 242, in resolve
    return self.temps[key]
KeyError: 'TS_TRXN'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/runner.py", line 191, in process_parquet_files
    filtered_df = apply_scenario_config(df.copy(), job_details[scenario_id])
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 90, in apply_scenario_config
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 86, in apply_scenario_config
    filtered_df = base_df.query(combined_conditions)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4823, in query
    res = self.eval(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4949, in eval
    return _eval(expr, inplace=inplace, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/eval.py", line 336, in eval
    parsed_expr = Expr(expr, engine=engine, parser=parser, env=env)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 809, in __init__
    self.terms = self.parse()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 828, in parse
    return self._visitor.visit(self.expr)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 418, in visit_Module
    return self.visit(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 421, in visit_Expr
    return self.visit(node.value, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 719, in visit_Compare
    return self.visit(binop)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 532, in visit_BinOp
    op, op_class, left, right = self._maybe_transform_eq_ne(node)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 452, in _maybe_transform_eq_ne
    left = self.visit(node.left, side="left")
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 644, in visit_Attribute
    resolved = self.visit(value).value
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 545, in visit_Name
    return self.term_type(node.id, self.env, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/ops.py", line 91, in __init__
    self._value = self._resolve_name()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/ops.py", line 115, in _resolve_name
    res = self.env.resolve(local_name, is_local=is_local)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 244, in resolve
    raise UndefinedVariableError(key, is_local) from err
pandas.errors.UndefinedVariableError: name 'TS_TRXN' is not defined
2024-10-20 07:09:01 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-20 07:09:01 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 07:09:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:09:07 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 07:09:07 - INFO - Pipeline execution completed successfully.
2024-10-20 07:10:17 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_28'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 07:10:17 - INFO - Starting scenario data retrieval.
2024-10-20 07:10:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:10:17 - INFO - Fetching scenario configuration data
2024-10-20 07:10:22 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_28')
        
2024-10-20 07:10:23 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 07:10:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:10:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:10:32 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 07:10:32 - INFO - Starting customer ID retrieval.
2024-10-20 07:10:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:10:41 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 07:10:41 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 07:10:41 - INFO - Starting threshold data retrieval.
2024-10-20 07:10:41 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:10:41 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 07:10:41 - INFO - Fetching threshold configuration data.
2024-10-20 07:10:41 - DEBUG - Processing scenario ID: TS_SCN_28
2024-10-20 07:10:41 - DEBUG - Executing SQL query for scenario ID TS_SCN_28: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_28'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:10:45 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_28'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:10:45 - INFO - Threshold data fetching completed successfully.
2024-10-20 07:10:45 - INFO - Starting customer ID processing.
2024-10-20 07:10:45 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 07:10:50 - INFO - Spark session initialized successfully.
2024-10-20 07:10:50 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:10:50 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:10:50 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:10:50 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:11:56 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 07:11:56 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:12:03 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 07:12:03 - INFO - Fetching transaction data for 1 customers.
2024-10-20 07:12:06 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 07:12:15 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 07:12:59 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:13:02 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 07:13:02 - INFO - All customer chunks processed.
2024-10-20 07:13:03 - INFO - Spark session stopped.
2024-10-20 07:13:03 - INFO - Starting Parquet files processing.
2024-10-20 07:13:03 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 07:13:03 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:13:03 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 07:13:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:03 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_28
2024-10-20 07:13:03 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 07:13:03 - INFO - Initializing AlertChecker for TS_SCN_28
2024-10-20 07:13:03 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_28
2024-10-20 07:13:03 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 07:13:04 - INFO - Job ID - 157 | Unusual Wire Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-20 07:13:04 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 07:13:04 - INFO - Generated alert transaction table with 5 rows.
2024-10-20 07:13:04 - INFO - Generated evidence report with 1 rows.
2024-10-20 07:13:04 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 07:13:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:09 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_28'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 07:13:09 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 07:13:09 - INFO - Unusual Wire Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-20 07:13:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:09 - INFO - Unusual Wire Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-20 07:13:14 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1124355809')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 07:13:21 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 07:13:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:45 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:59 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_28
2024-10-20 07:13:59 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 07:13:59 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-20 07:13:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:13:59 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_28
2024-10-20 07:13:59 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 07:13:59 - INFO - Initializing AlertChecker for TS_SCN_28
2024-10-20 07:13:59 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_28
2024-10-20 07:13:59 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 07:14:00 - INFO - No Alerts found!
2024-10-20 07:14:00 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 07:14:00 - INFO - No alerts generated!
2024-10-20 07:14:00 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_28
2024-10-20 07:14:00 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 07:14:00 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-20 07:14:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:14:00 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_28
2024-10-20 07:14:00 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 07:14:00 - INFO - Initializing AlertChecker for TS_SCN_28
2024-10-20 07:14:00 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_28
2024-10-20 07:14:00 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 07:14:00 - INFO - No Alerts found!
2024-10-20 07:14:00 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 07:14:00 - INFO - No alerts generated!
2024-10-20 07:14:00 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_28
2024-10-20 07:14:00 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 07:14:01 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-20 07:14:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:14:01 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_28
2024-10-20 07:14:01 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 07:14:01 - INFO - Initializing AlertChecker for TS_SCN_28
2024-10-20 07:14:01 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_28
2024-10-20 07:14:01 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 07:14:01 - INFO - No Alerts found!
2024-10-20 07:14:01 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 07:14:01 - INFO - No alerts generated!
2024-10-20 07:14:01 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_28
2024-10-20 07:14:01 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 07:14:01 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-20 07:14:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:14:02 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_28
2024-10-20 07:14:02 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 07:14:02 - INFO - Initializing AlertChecker for TS_SCN_28
2024-10-20 07:14:02 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_28
2024-10-20 07:14:02 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 07:14:02 - INFO - No Alerts found!
2024-10-20 07:14:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 07:14:02 - INFO - No alerts generated!
2024-10-20 07:14:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_28
2024-10-20 07:14:02 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 07:14:02 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-20 07:14:02 - ERROR - No data found for scenario ID TS_SCN_28 in Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet after applying scenario config filters.
2024-10-20 07:14:02 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-20 07:14:03 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 07:14:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:14:09 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 07:14:09 - INFO - Pipeline execution completed successfully.
2024-10-20 07:52:49 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_12'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 07:52:49 - INFO - Starting scenario data retrieval.
2024-10-20 07:52:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:52:49 - INFO - Fetching scenario configuration data
2024-10-20 07:52:54 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_12')
        
2024-10-20 07:52:55 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 07:52:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:52:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:53:04 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 07:53:04 - INFO - Starting customer ID retrieval.
2024-10-20 07:53:04 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:53:12 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 07:53:12 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 07:53:12 - INFO - Starting threshold data retrieval.
2024-10-20 07:53:12 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:53:12 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 07:53:12 - INFO - Fetching threshold configuration data.
2024-10-20 07:53:12 - DEBUG - Processing scenario ID: TS_SCN_12
2024-10-20 07:53:12 - DEBUG - Executing SQL query for scenario ID TS_SCN_12: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:53:16 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 07:53:16 - INFO - Threshold data fetching completed successfully.
2024-10-20 07:53:16 - INFO - Starting customer ID processing.
2024-10-20 07:53:16 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 07:53:20 - INFO - Spark session initialized successfully.
2024-10-20 07:53:20 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:53:20 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:53:20 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:53:20 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:54:11 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 07:54:11 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 07:54:31 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 07:54:31 - INFO - Fetching transaction data for 1 customers.
2024-10-20 07:54:31 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 07:54:34 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 07:54:45 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 07:54:57 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:54:57 - INFO - All customer chunks processed.
2024-10-20 07:54:57 - INFO - Spark session stopped.
2024-10-20 07:54:57 - INFO - Starting Parquet files processing.
2024-10-20 07:54:57 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 07:54:57 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 07:54:57 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 07:54:57 - ERROR - Error applying scenario config conditions to DataFrame: invalid syntax (<unknown>, line 1)
2024-10-20 07:54:57 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet: invalid syntax (<unknown>, line 1)
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/runner.py", line 191, in process_parquet_files
    filtered_df = apply_scenario_config(df.copy(), job_details[scenario_id])
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 90, in apply_scenario_config
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 86, in apply_scenario_config
    filtered_df = base_df.query(combined_conditions)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4823, in query
    res = self.eval(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4949, in eval
    return _eval(expr, inplace=inplace, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/eval.py", line 336, in eval
    parsed_expr = Expr(expr, engine=engine, parser=parser, env=env)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 809, in __init__
    self.terms = self.parse()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 828, in parse
    return self._visitor.visit(self.expr)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 408, in visit
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 404, in visit
    node = ast.fix_missing_locations(ast.parse(clean))
  File "/usr/lib/python3.10/ast.py", line 50, in parse
    return compile(source, filename, mode, flags,
  File "<unknown>", line 1
    --
      ^
SyntaxError: invalid syntax
2024-10-20 07:54:57 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-20 07:54:58 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 07:54:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 07:55:05 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 07:55:05 - INFO - Pipeline execution completed successfully.
2024-10-20 08:00:30 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_12'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 08:00:30 - INFO - Starting scenario data retrieval.
2024-10-20 08:00:30 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:00:30 - INFO - Fetching scenario configuration data
2024-10-20 08:00:35 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_12')
        
2024-10-20 08:00:37 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 08:00:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:00:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:00:47 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 08:00:47 - INFO - Starting customer ID retrieval.
2024-10-20 08:00:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:00:55 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 08:00:55 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 08:00:55 - INFO - Starting threshold data retrieval.
2024-10-20 08:00:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:00:55 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 08:00:55 - INFO - Fetching threshold configuration data.
2024-10-20 08:00:55 - DEBUG - Processing scenario ID: TS_SCN_12
2024-10-20 08:00:55 - DEBUG - Executing SQL query for scenario ID TS_SCN_12: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:00:59 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:00:59 - INFO - Threshold data fetching completed successfully.
2024-10-20 08:00:59 - INFO - Starting customer ID processing.
2024-10-20 08:00:59 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 08:01:02 - INFO - Spark session initialized successfully.
2024-10-20 08:01:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:01:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:01:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:01:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:01:31 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 08:01:31 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:01:34 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 08:01:34 - INFO - Fetching transaction data for 1 customers.
2024-10-20 08:01:38 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 08:01:56 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 08:02:05 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 08:02:26 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:02:26 - INFO - All customer chunks processed.
2024-10-20 08:02:26 - INFO - Spark session stopped.
2024-10-20 08:02:26 - INFO - Starting Parquet files processing.
2024-10-20 08:02:26 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 08:02:26 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:02:27 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 08:02:27 - ERROR - Error applying scenario config conditions to DataFrame: expr cannot be an empty string
2024-10-20 08:02:27 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet: expr cannot be an empty string
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/runner.py", line 191, in process_parquet_files
    filtered_df = apply_scenario_config(df.copy(), job_details[scenario_id])
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 145, in apply_scenario_config
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 141, in apply_scenario_config
    filtered_df = base_df.query(combined_conditions)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4823, in query
    res = self.eval(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4949, in eval
    return _eval(expr, inplace=inplace, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/eval.py", line 303, in eval
    _check_expression(expr)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/eval.py", line 120, in _check_expression
    raise ValueError("expr cannot be an empty string")
ValueError: expr cannot be an empty string
2024-10-20 08:02:27 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-20 08:02:27 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 08:02:27 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:02:33 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 08:02:33 - INFO - Pipeline execution completed successfully.
2024-10-20 08:10:56 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_12'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 08:10:56 - INFO - Starting scenario data retrieval.
2024-10-20 08:10:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:10:56 - INFO - Fetching scenario configuration data
2024-10-20 08:11:03 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_12')
        
2024-10-20 08:11:04 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 08:11:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:11:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:11:14 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 08:11:14 - INFO - Starting customer ID retrieval.
2024-10-20 08:11:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:11:26 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 08:11:26 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 08:11:26 - INFO - Starting threshold data retrieval.
2024-10-20 08:11:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:11:26 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 08:11:26 - INFO - Fetching threshold configuration data.
2024-10-20 08:11:26 - DEBUG - Processing scenario ID: TS_SCN_12
2024-10-20 08:11:26 - DEBUG - Executing SQL query for scenario ID TS_SCN_12: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:11:31 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:11:31 - INFO - Threshold data fetching completed successfully.
2024-10-20 08:11:31 - INFO - Starting customer ID processing.
2024-10-20 08:11:31 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 08:11:34 - INFO - Spark session initialized successfully.
2024-10-20 08:11:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:11:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:11:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:11:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:11:58 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 08:11:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:12:20 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:12:20 - INFO - Fetching transaction data for 1 customers.
2024-10-20 08:12:25 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 08:12:31 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 08:12:32 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 08:12:58 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 08:12:58 - INFO - All customer chunks processed.
2024-10-20 08:12:58 - INFO - Spark session stopped.
2024-10-20 08:12:58 - INFO - Starting Parquet files processing.
2024-10-20 08:12:58 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 08:12:58 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:12:58 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 08:12:58 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:12:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:12:58 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:12:58 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:12:58 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:12:58 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:12:58 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:12:59 - INFO - No Alerts found!
2024-10-20 08:12:59 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:12:59 - INFO - No alerts generated!
2024-10-20 08:12:59 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_12
2024-10-20 08:12:59 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 08:13:00 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-20 08:13:00 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:13:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:00 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:13:00 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:13:00 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:13:00 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:13:00 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:13:00 - INFO - No Alerts found!
2024-10-20 08:13:00 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:13:00 - INFO - No alerts generated!
2024-10-20 08:13:00 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_12
2024-10-20 08:13:00 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 08:13:00 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-20 08:13:00 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:13:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:00 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:13:00 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:13:00 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:13:00 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:13:00 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:13:01 - INFO - No Alerts found!
2024-10-20 08:13:01 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:13:01 - INFO - No alerts generated!
2024-10-20 08:13:01 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_12
2024-10-20 08:13:01 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 08:13:01 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-20 08:13:01 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:13:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:01 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:13:01 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:13:01 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:13:01 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:13:01 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:13:02 - INFO - No Alerts found!
2024-10-20 08:13:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:13:02 - INFO - No alerts generated!
2024-10-20 08:13:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_12
2024-10-20 08:13:02 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 08:13:02 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-20 08:13:02 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:13:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:02 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:13:02 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:13:02 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:13:02 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:13:02 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:13:02 - INFO - No Alerts found!
2024-10-20 08:13:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:13:02 - INFO - No alerts generated!
2024-10-20 08:13:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_12
2024-10-20 08:13:02 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 08:13:02 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-20 08:13:02 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:13:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:02 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:13:02 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:13:02 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:13:02 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:13:02 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:13:02 - INFO - No data found for lookback period
2024-10-20 08:13:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:13:02 - INFO - No alerts generated!
2024-10-20 08:13:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_12
2024-10-20 08:13:02 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-20 08:13:03 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 08:13:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:13:09 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 08:13:09 - INFO - Pipeline execution completed successfully.
2024-10-20 08:14:42 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_12'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 08:14:42 - INFO - Starting scenario data retrieval.
2024-10-20 08:14:42 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:14:42 - INFO - Fetching scenario configuration data
2024-10-20 08:14:49 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_12')
        
2024-10-20 08:14:50 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 08:14:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:14:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:14:59 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 08:14:59 - INFO - Starting customer ID retrieval.
2024-10-20 08:14:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:15:06 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 08:15:06 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 08:15:06 - INFO - Starting threshold data retrieval.
2024-10-20 08:15:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:15:06 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 08:15:06 - INFO - Fetching threshold configuration data.
2024-10-20 08:15:06 - DEBUG - Processing scenario ID: TS_SCN_12
2024-10-20 08:15:06 - DEBUG - Executing SQL query for scenario ID TS_SCN_12: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:15:11 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_12'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 08:15:11 - INFO - Threshold data fetching completed successfully.
2024-10-20 08:15:11 - INFO - Starting customer ID processing.
2024-10-20 08:15:11 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 08:15:16 - INFO - Spark session initialized successfully.
2024-10-20 08:15:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:15:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:15:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:15:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:15:48 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 08:15:48 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 08:16:05 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 08:16:05 - INFO - Fetching transaction data for 1 customers.
2024-10-20 08:16:09 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 08:16:15 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 08:16:34 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 08:17:08 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:17:08 - INFO - All customer chunks processed.
2024-10-20 08:17:08 - INFO - Spark session stopped.
2024-10-20 08:17:08 - INFO - Starting Parquet files processing.
2024-10-20 08:17:08 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 08:17:08 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 08:17:09 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 08:17:09 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:17:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:09 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:17:09 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:17:09 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:17:09 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:17:09 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:17:10 - INFO - Job ID - 157 | Unusual Account Activity | Total no. of alerts found - 1
2024-10-20 08:17:10 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 08:17:10 - INFO - Generated alert transaction table with 6 rows.
2024-10-20 08:17:11 - INFO - Generated evidence report with 1 rows.
2024-10-20 08:17:11 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 08:17:11 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:17 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_12'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 08:17:18 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 08:17:18 - INFO - Unusual Account Activity AlertRiskScoring has been initialized.
2024-10-20 08:17:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:18 - INFO - Unusual Account Activity : calculating Prior Alert Scores.
2024-10-20 08:17:23 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1124355809')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 08:17:28 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 08:17:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:17:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:05 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_12
2024-10-20 08:18:05 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 08:18:06 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-20 08:18:06 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:18:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:06 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:18:06 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:18:06 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:18:06 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:18:06 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:18:06 - INFO - No Alerts found!
2024-10-20 08:18:06 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:18:06 - INFO - No alerts generated!
2024-10-20 08:18:06 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_12
2024-10-20 08:18:06 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 08:18:06 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-20 08:18:06 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:18:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:06 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:18:06 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:18:06 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:18:06 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:18:06 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:18:07 - INFO - Job ID - 157 | Unusual Account Activity | Total no. of alerts found - 1
2024-10-20 08:18:07 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 08:18:07 - INFO - Generated alert transaction table with 5 rows.
2024-10-20 08:18:07 - INFO - Generated evidence report with 1 rows.
2024-10-20 08:18:07 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 08:18:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:12 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_12'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 08:18:12 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 08:18:12 - INFO - Unusual Account Activity AlertRiskScoring has been initialized.
2024-10-20 08:18:12 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:12 - INFO - Unusual Account Activity : calculating Prior Alert Scores.
2024-10-20 08:18:18 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1124800551')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 08:18:23 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 08:18:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:27 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:56 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_12
2024-10-20 08:18:56 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 08:18:56 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-20 08:18:56 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:18:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:56 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:18:56 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:18:56 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:18:56 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:18:56 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:18:57 - INFO - No Alerts found!
2024-10-20 08:18:57 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:18:57 - INFO - No alerts generated!
2024-10-20 08:18:57 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_12
2024-10-20 08:18:57 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 08:18:57 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-20 08:18:57 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:18:57 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:18:57 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:18:57 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:18:57 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:18:57 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:18:57 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:18:58 - INFO - Job ID - 157 | Unusual Account Activity | Total no. of alerts found - 1
2024-10-20 08:18:58 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 08:18:58 - INFO - Generated alert transaction table with 5 rows.
2024-10-20 08:18:58 - INFO - Generated evidence report with 1 rows.
2024-10-20 08:18:58 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 08:18:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:03 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_12'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 08:19:03 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 08:19:03 - INFO - Unusual Account Activity AlertRiskScoring has been initialized.
2024-10-20 08:19:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:03 - INFO - Unusual Account Activity : calculating Prior Alert Scores.
2024-10-20 08:19:09 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1711997576')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 08:19:14 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 08:19:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:30 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:50 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_12
2024-10-20 08:19:50 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 08:19:50 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-20 08:19:50 - INFO - No scenario configurations found for transaction data.
2024-10-20 08:19:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:50 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_12
2024-10-20 08:19:50 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 08:19:50 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-20 08:19:50 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_12
2024-10-20 08:19:50 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 08:19:50 - INFO - No data found for lookback period
2024-10-20 08:19:50 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 08:19:50 - INFO - No alerts generated!
2024-10-20 08:19:50 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_12
2024-10-20 08:19:50 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-20 08:19:50 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 08:19:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 08:19:56 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 08:19:56 - INFO - Pipeline execution completed successfully.
2024-10-20 12:18:47 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_29'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 12:18:47 - INFO - Starting scenario data retrieval.
2024-10-20 12:18:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:18:47 - INFO - Fetching scenario configuration data
2024-10-20 12:18:53 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_29')
        
2024-10-20 12:18:53 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 12:18:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:18:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:19:02 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 12:19:02 - INFO - Starting customer ID retrieval.
2024-10-20 12:19:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:19:10 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 12:19:10 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 12:19:10 - INFO - Starting threshold data retrieval.
2024-10-20 12:19:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:19:10 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 12:19:10 - INFO - Fetching threshold configuration data.
2024-10-20 12:19:10 - DEBUG - Processing scenario ID: TS_SCN_29
2024-10-20 12:19:10 - DEBUG - Executing SQL query for scenario ID TS_SCN_29: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 12:19:13 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 12:19:14 - INFO - Threshold data fetching completed successfully.
2024-10-20 12:19:14 - INFO - Starting customer ID processing.
2024-10-20 12:19:14 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 12:19:17 - INFO - Spark session initialized successfully.
2024-10-20 12:19:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:19:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:19:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:19:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:19:59 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 12:19:59 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:20:07 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 12:20:07 - INFO - Fetching transaction data for 1 customers.
2024-10-20 12:20:10 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 12:20:20 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 12:20:32 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 12:21:14 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 12:21:14 - INFO - All customer chunks processed.
2024-10-20 12:21:14 - INFO - Spark session stopped.
2024-10-20 12:21:14 - INFO - Starting Parquet files processing.
2024-10-20 12:21:14 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 12:21:14 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 12:21:14 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 12:21:14 - ERROR - Error applying scenario config conditions to DataFrame: name 'TS_TRXN' is not defined
2024-10-20 12:21:14 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet: name 'TS_TRXN' is not defined
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 231, in resolve
    return self.resolvers[key]
  File "/usr/lib/python3.10/collections/__init__.py", line 986, in __getitem__
    return self.__missing__(key)            # support subclasses that define __missing__
  File "/usr/lib/python3.10/collections/__init__.py", line 978, in __missing__
    raise KeyError(key)
KeyError: 'TS_TRXN'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 242, in resolve
    return self.temps[key]
KeyError: 'TS_TRXN'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/runner.py", line 191, in process_parquet_files
    filtered_df = apply_scenario_config(df.copy(), job_details[scenario_id])
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 95, in apply_scenario_config
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/util.py", line 91, in apply_scenario_config
    filtered_df = base_df.query(combined_conditions)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4823, in query
    res = self.eval(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4949, in eval
    return _eval(expr, inplace=inplace, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/eval.py", line 336, in eval
    parsed_expr = Expr(expr, engine=engine, parser=parser, env=env)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 809, in __init__
    self.terms = self.parse()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 828, in parse
    return self._visitor.visit(self.expr)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 418, in visit_Module
    return self.visit(expr, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 421, in visit_Expr
    return self.visit(node.value, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 719, in visit_Compare
    return self.visit(binop)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 532, in visit_BinOp
    op, op_class, left, right = self._maybe_transform_eq_ne(node)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 452, in _maybe_transform_eq_ne
    left = self.visit(node.left, side="left")
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 644, in visit_Attribute
    resolved = self.visit(value).value
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 412, in visit
    return visitor(node, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/expr.py", line 545, in visit_Name
    return self.term_type(node.id, self.env, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/ops.py", line 91, in __init__
    self._value = self._resolve_name()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/ops.py", line 115, in _resolve_name
    res = self.env.resolve(local_name, is_local=is_local)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/computation/scope.py", line 244, in resolve
    raise UndefinedVariableError(key, is_local) from err
pandas.errors.UndefinedVariableError: name 'TS_TRXN' is not defined
2024-10-20 12:21:14 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-20 12:21:15 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 12:21:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:21:22 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 12:21:22 - INFO - Pipeline execution completed successfully.
2024-10-20 12:22:53 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_29'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 12:22:53 - INFO - Starting scenario data retrieval.
2024-10-20 12:22:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:22:53 - INFO - Fetching scenario configuration data
2024-10-20 12:22:57 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_29')
        
2024-10-20 12:22:58 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 12:22:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:22:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:23:08 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 12:23:08 - INFO - Starting customer ID retrieval.
2024-10-20 12:23:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:23:30 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 12:23:30 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 12:23:30 - INFO - Starting threshold data retrieval.
2024-10-20 12:23:30 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:23:30 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 12:23:30 - INFO - Fetching threshold configuration data.
2024-10-20 12:23:30 - DEBUG - Processing scenario ID: TS_SCN_29
2024-10-20 12:23:30 - DEBUG - Executing SQL query for scenario ID TS_SCN_29: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 12:23:33 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 12:23:34 - INFO - Threshold data fetching completed successfully.
2024-10-20 12:23:34 - INFO - Starting customer ID processing.
2024-10-20 12:23:34 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 12:23:38 - INFO - Spark session initialized successfully.
2024-10-20 12:23:38 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:23:38 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:23:38 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:23:38 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:24:16 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 12:24:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 12:24:43 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 12:24:43 - INFO - Fetching transaction data for 1 customers.
2024-10-20 12:24:46 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 12:25:14 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 12:25:14 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 12:25:17 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 12:25:17 - INFO - All customer chunks processed.
2024-10-20 12:25:18 - INFO - Spark session stopped.
2024-10-20 12:25:18 - INFO - Starting Parquet files processing.
2024-10-20 12:25:18 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 12:25:18 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 12:25:18 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 12:25:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:18 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 12:25:18 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 12:25:18 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 12:25:18 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 12:25:18 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 12:25:19 - INFO - No Alerts found!
2024-10-20 12:25:19 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 12:25:19 - INFO - No alerts generated!
2024-10-20 12:25:19 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_29
2024-10-20 12:25:19 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 12:25:19 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-20 12:25:19 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:19 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 12:25:19 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 12:25:19 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 12:25:19 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 12:25:19 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 12:25:19 - INFO - No Alerts found!
2024-10-20 12:25:19 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 12:25:19 - INFO - No alerts generated!
2024-10-20 12:25:19 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_29
2024-10-20 12:25:19 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 12:25:20 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-20 12:25:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:20 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 12:25:20 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 12:25:20 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 12:25:20 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 12:25:20 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 12:25:20 - INFO - No Alerts found!
2024-10-20 12:25:20 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 12:25:20 - INFO - No alerts generated!
2024-10-20 12:25:20 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_29
2024-10-20 12:25:20 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 12:25:20 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-20 12:25:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:20 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 12:25:20 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 12:25:20 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 12:25:20 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 12:25:20 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 12:25:20 - INFO - No Alerts found!
2024-10-20 12:25:20 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 12:25:20 - INFO - No alerts generated!
2024-10-20 12:25:20 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_29
2024-10-20 12:25:20 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 12:25:21 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-20 12:25:21 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:21 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 12:25:21 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 12:25:21 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 12:25:21 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 12:25:21 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 12:25:21 - INFO - Job ID - 157 | Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-20 12:25:21 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 12:25:21 - INFO - Generated alert transaction table with 3 rows.
2024-10-20 12:25:21 - INFO - Generated evidence report with 1 rows.
2024-10-20 12:25:21 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 12:25:21 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:25 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_29'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 12:25:25 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 12:25:25 - INFO - Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-20 12:25:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:25 - INFO - Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-20 12:25:29 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1131345579')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 12:25:36 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 12:25:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:40 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:46 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:25:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:26:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:26:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:26:13 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_29
2024-10-20 12:26:13 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 12:26:13 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-20 12:26:13 - ERROR - No data found for scenario ID TS_SCN_29 in Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet after applying scenario config filters.
2024-10-20 12:26:13 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-20 12:26:13 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 12:26:13 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 12:26:20 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 12:26:20 - INFO - Pipeline execution completed successfully.
2024-10-20 18:21:27 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_29'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-20 18:21:27 - INFO - Starting scenario data retrieval.
2024-10-20 18:21:27 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:21:27 - INFO - Fetching scenario configuration data
2024-10-20 18:21:32 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_29')
        
2024-10-20 18:21:34 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-20 18:21:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:21:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:21:43 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-20 18:21:43 - INFO - Starting customer ID retrieval.
2024-10-20 18:21:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:21:50 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-20 18:21:51 - INFO - Successfully fetched 125001 customer IDs.
2024-10-20 18:21:51 - INFO - Starting threshold data retrieval.
2024-10-20 18:21:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:21:51 - INFO - SQLQueryExecutor initialized successfully.
2024-10-20 18:21:51 - INFO - Fetching threshold configuration data.
2024-10-20 18:21:51 - DEBUG - Processing scenario ID: TS_SCN_29
2024-10-20 18:21:51 - DEBUG - Executing SQL query for scenario ID TS_SCN_29: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 18:21:55 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_29'
     AND TS_THRESHOLD_SET.IS_ACTIVE = 1
2024-10-20 18:21:55 - INFO - Threshold data fetching completed successfully.
2024-10-20 18:21:55 - INFO - Starting customer ID processing.
2024-10-20 18:21:55 - INFO - Initializing Spark session with JDBC configurations.
2024-10-20 18:21:59 - INFO - Spark session initialized successfully.
2024-10-20 18:21:59 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 18:21:59 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 18:21:59 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 18:21:59 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 18:22:23 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 18:22:23 - INFO - Fetching transaction data for 25000 customers.
2024-10-20 18:22:40 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 18:22:40 - INFO - Fetching transaction data for 1 customers.
2024-10-20 18:22:44 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 18:22:57 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 18:23:24 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 18:23:34 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 18:23:34 - INFO - All customer chunks processed.
2024-10-20 18:23:34 - INFO - Spark session stopped.
2024-10-20 18:23:34 - INFO - Starting Parquet files processing.
2024-10-20 18:23:34 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-20 18:23:34 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-20 18:23:35 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-20 18:23:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:35 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 18:23:35 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 18:23:35 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 18:23:35 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 18:23:35 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 18:23:35 - INFO - No Alerts found!
2024-10-20 18:23:35 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 18:23:35 - INFO - No alerts generated!
2024-10-20 18:23:35 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_29
2024-10-20 18:23:35 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-20 18:23:35 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-20 18:23:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:35 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 18:23:35 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 18:23:35 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 18:23:35 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 18:23:35 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 18:23:35 - INFO - No Alerts found!
2024-10-20 18:23:35 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 18:23:35 - INFO - No alerts generated!
2024-10-20 18:23:35 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_29
2024-10-20 18:23:35 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-20 18:23:36 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-20 18:23:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:36 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 18:23:36 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 18:23:36 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 18:23:36 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 18:23:36 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 18:23:36 - INFO - No Alerts found!
2024-10-20 18:23:36 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 18:23:36 - INFO - No alerts generated!
2024-10-20 18:23:36 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_29
2024-10-20 18:23:36 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-20 18:23:36 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-20 18:23:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:36 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 18:23:36 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 18:23:36 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 18:23:36 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 18:23:36 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 18:23:36 - INFO - No Alerts found!
2024-10-20 18:23:36 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-20 18:23:36 - INFO - No alerts generated!
2024-10-20 18:23:36 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_29
2024-10-20 18:23:36 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-20 18:23:37 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-20 18:23:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:37 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_29
2024-10-20 18:23:37 - INFO - ALERTCHECKER initialized successfully.
2024-10-20 18:23:37 - INFO - Initializing AlertChecker for TS_SCN_29
2024-10-20 18:23:37 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_29
2024-10-20 18:23:37 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-20 18:23:37 - INFO - Job ID - 157 | Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-20 18:23:37 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-20 18:23:37 - INFO - Generated alert transaction table with 3 rows.
2024-10-20 18:23:37 - INFO - Generated evidence report with 1 rows.
2024-10-20 18:23:37 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-20 18:23:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:42 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_29'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-20 18:23:43 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-20 18:23:43 - INFO - Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-20 18:23:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:43 - INFO - Unusual MI Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-20 18:23:47 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1131345579')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-20'
                
2024-10-20 18:23:53 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-20 18:23:54 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_29
2024-10-20 18:23:54 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-20 18:23:54 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-20 18:23:54 - ERROR - No data found for scenario ID TS_SCN_29 in Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet after applying scenario config filters.
2024-10-20 18:23:54 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-20 18:23:54 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-20 18:23:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-20 18:23:59 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-20 18:23:59 - INFO - Pipeline execution completed successfully.
