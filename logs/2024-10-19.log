2024-10-19 12:32:10 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 12:32:10 - INFO - Starting scenario data retrieval.
2024-10-19 12:32:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:32:10 - INFO - Fetching scenario configuration data
2024-10-19 12:32:16 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 12:32:17 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 12:32:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:32:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:32:25 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 12:32:25 - INFO - Starting customer ID retrieval.
2024-10-19 12:32:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:32:35 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 12:32:36 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 12:32:36 - INFO - Starting threshold data retrieval.
2024-10-19 12:32:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:32:36 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 12:32:36 - INFO - Fetching threshold configuration data.
2024-10-19 12:32:36 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 12:32:36 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:32:39 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:32:39 - INFO - Threshold data fetching completed successfully.
2024-10-19 12:32:39 - INFO - Starting customer ID processing.
2024-10-19 12:32:39 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 12:32:43 - INFO - Spark session initialized successfully.
2024-10-19 12:32:43 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:32:43 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:32:43 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:32:43 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:33:18 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:33:18 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:33:32 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:33:32 - INFO - Fetching transaction data for 1 customers.
2024-10-19 12:33:35 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:33:37 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:33:43 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:34:51 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:34:51 - INFO - All customer chunks processed.
2024-10-19 12:34:52 - INFO - Spark session stopped.
2024-10-19 12:34:52 - INFO - Starting Parquet files processing.
2024-10-19 12:34:52 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 12:34:52 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:34:52 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 12:34:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:34:52 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:34:52 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:34:52 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:34:52 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:34:52 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:34:53 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:34:53 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:34:53 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:34:53 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:34:53 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:34:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:34:58 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:34:58 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:34:58 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:34:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:34:58 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:35:02 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:35:08 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:35:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:08 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:08 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:35:08 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 12:35:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:08 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:35:08 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:35:08 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:35:08 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:35:08 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:35:08 - INFO - No Alerts found!
2024-10-19 12:35:08 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:35:08 - INFO - No alerts generated!
2024-10-19 12:35:08 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:08 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:35:09 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 12:35:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:09 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:35:09 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:35:09 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:35:09 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:35:09 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:35:09 - INFO - No Alerts found!
2024-10-19 12:35:09 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:35:09 - INFO - No alerts generated!
2024-10-19 12:35:09 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:09 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:35:09 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 12:35:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:09 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:35:09 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:35:09 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:35:09 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:35:09 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:35:09 - INFO - No Alerts found!
2024-10-19 12:35:09 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:35:09 - INFO - No alerts generated!
2024-10-19 12:35:09 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:09 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:35:09 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 12:35:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:10 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:35:10 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:35:10 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:35:10 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:35:10 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:35:10 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:35:10 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:35:10 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:35:10 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:35:10 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:35:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:14 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:35:14 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:35:14 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:35:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:14 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:35:18 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:35:23 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:35:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:24 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:24 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:35:24 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 12:35:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:24 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:35:24 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:35:24 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:35:24 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:35:24 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:35:24 - INFO - No data found for lookback period
2024-10-19 12:35:24 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:35:24 - INFO - No alerts generated!
2024-10-19 12:35:24 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 12:35:24 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 12:35:24 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 12:35:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:35:29 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 12:35:29 - INFO - Pipeline execution completed successfully.
2024-10-19 12:37:11 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 12:37:11 - INFO - Starting scenario data retrieval.
2024-10-19 12:37:11 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:37:11 - INFO - Fetching scenario configuration data
2024-10-19 12:37:16 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 12:37:17 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 12:37:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:37:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:37:26 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 12:37:26 - INFO - Starting customer ID retrieval.
2024-10-19 12:37:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:37:32 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 12:37:32 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 12:37:32 - INFO - Starting threshold data retrieval.
2024-10-19 12:37:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:37:32 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 12:37:32 - INFO - Fetching threshold configuration data.
2024-10-19 12:37:32 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 12:37:32 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:37:36 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:37:36 - INFO - Threshold data fetching completed successfully.
2024-10-19 12:37:36 - INFO - Starting customer ID processing.
2024-10-19 12:37:36 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 12:37:49 - INFO - Spark session initialized successfully.
2024-10-19 12:37:49 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:37:49 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:37:49 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:37:49 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:39:05 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:39:05 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:39:05 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:39:05 - INFO - Fetching transaction data for 1 customers.
2024-10-19 12:39:08 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:39:16 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:39:32 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:40:09 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:40:09 - INFO - All customer chunks processed.
2024-10-19 12:40:10 - INFO - Spark session stopped.
2024-10-19 12:40:10 - INFO - Starting Parquet files processing.
2024-10-19 12:40:10 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 12:40:10 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:40:10 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 12:40:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:10 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:40:10 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:40:10 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:40:10 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:40:10 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:40:11 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:40:11 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:40:11 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:40:11 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:40:11 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:40:11 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:15 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:40:15 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:40:15 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:40:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:15 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:40:19 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:40:24 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:40:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:45 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:57 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 12:40:57 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:40:58 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 12:40:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:58 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:40:58 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:40:58 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:40:58 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:40:58 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:40:58 - INFO - No Alerts found!
2024-10-19 12:40:58 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:40:58 - INFO - No alerts generated!
2024-10-19 12:40:58 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 12:40:58 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:40:58 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 12:40:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:58 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:40:58 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:40:58 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:40:58 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:40:58 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:40:58 - INFO - No Alerts found!
2024-10-19 12:40:58 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:40:58 - INFO - No alerts generated!
2024-10-19 12:40:58 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 12:40:58 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:40:58 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 12:40:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:59 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:40:59 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:40:59 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:40:59 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:40:59 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:40:59 - INFO - No Alerts found!
2024-10-19 12:40:59 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:40:59 - INFO - No alerts generated!
2024-10-19 12:40:59 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 12:40:59 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:40:59 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 12:40:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:40:59 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:40:59 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:40:59 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:40:59 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:40:59 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:40:59 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:40:59 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:40:59 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:40:59 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:40:59 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:40:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:03 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:41:03 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:41:03 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:41:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:03 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:41:07 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:41:13 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:41:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:39 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:44 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 12:41:44 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:41:44 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 12:41:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:44 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:41:44 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:41:44 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:41:44 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:41:44 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:41:44 - INFO - No data found for lookback period
2024-10-19 12:41:44 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:41:44 - INFO - No alerts generated!
2024-10-19 12:41:44 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 12:41:44 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 12:41:45 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 12:41:45 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:41:49 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 12:41:49 - INFO - Pipeline execution completed successfully.
2024-10-19 12:51:05 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 12:51:05 - INFO - Starting scenario data retrieval.
2024-10-19 12:51:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:51:05 - INFO - Fetching scenario configuration data
2024-10-19 12:51:09 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 12:51:10 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 12:51:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:51:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:51:18 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 12:51:18 - INFO - Starting customer ID retrieval.
2024-10-19 12:51:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:51:23 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 12:51:23 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 12:51:23 - INFO - Starting threshold data retrieval.
2024-10-19 12:51:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:51:23 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 12:51:23 - INFO - Fetching threshold configuration data.
2024-10-19 12:51:23 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 12:51:23 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:51:27 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:51:27 - INFO - Threshold data fetching completed successfully.
2024-10-19 12:51:27 - INFO - Starting customer ID processing.
2024-10-19 12:51:27 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 12:51:30 - INFO - Spark session initialized successfully.
2024-10-19 12:51:30 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:51:30 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:51:30 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:51:30 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:52:28 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:52:28 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:52:53 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:52:53 - INFO - Fetching transaction data for 1 customers.
2024-10-19 12:52:57 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:53:08 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:53:50 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:53:53 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:53:53 - INFO - All customer chunks processed.
2024-10-19 12:53:54 - INFO - Spark session stopped.
2024-10-19 12:53:54 - INFO - Starting Parquet files processing.
2024-10-19 12:53:54 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 12:53:54 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:53:54 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 12:53:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:53:55 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:53:55 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:53:55 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:53:55 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:53:55 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:53:55 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:53:55 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:53:55 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:53:55 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:53:55 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:53:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:53:58 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:53:59 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:53:59 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:53:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:53:59 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:54:14 - ERROR - Database connection error: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 12:54:14 - ERROR - SQLAlchemy Error executing SQL query - 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                 | (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 12:54:14 - ERROR - Error running prior alert scoring: 'ACCT_ID'
2024-10-19 12:54:14 - ERROR - Error during alert risk scoring: 'ACCT_ID'
2024-10-19 12:54:14 - ERROR - Error in alert_score_table: 'ACCT_ID'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 233, in alert_score_table
    result_df = alert_risk_scorer.alert_risk_scoring(result_df)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/alert_risk_scoring.py", line 219, in alert_risk_scoring
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/alert_risk_scoring.py", line 158, in alert_risk_scoring
    score_dfs['PRIOR_ALERT'] = prior_alert_scorer.run_prior_alert_scoring()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 121, in run_prior_alert_scoring
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 113, in run_prior_alert_scoring
    prior_alert_data_df['PRIOR_ALERT_SCORE'], prior_alert_data_df['LIST_PRIOR_ALERTS'], prior_alert_data_df['AUTO_REASON'] = zip(*prior_alert_data_df.apply(lambda row: self.prior_alert_score(row, prior_df), axis=1))
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 10374, in apply
    return op.apply().__finalize__(self, method="apply")
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 916, in apply
    return self.apply_standard()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 1063, in apply_standard
    results, res_index = self.apply_series_generator()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 1081, in apply_series_generator
    results[i] = self.func(v, *self.args, **self.kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 113, in <lambda>
    prior_alert_data_df['PRIOR_ALERT_SCORE'], prior_alert_data_df['LIST_PRIOR_ALERTS'], prior_alert_data_df['AUTO_REASON'] = zip(*prior_alert_data_df.apply(lambda row: self.prior_alert_score(row, prior_df), axis=1))
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 70, in prior_alert_score
    prior_entity_ids_str = ','.join(prior_df['ACCT_ID'].astype(str).values) if self.job_details['SCENARIO_FOCUS'] == 'ACCOUNT' else ','.join(prior_df['CUST_ID'].astype(str).values)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/range.py", line 417, in get_loc
    raise KeyError(key)
KeyError: 'ACCT_ID'
2024-10-19 12:54:14 - ERROR - Error processing data with ALERTCHECKER: 'ACCT_ID'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 106, in process_with_alert_checker
    ars_table = self.alert_score_table(alert_table, alert_trxn_table, df)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 240, in alert_score_table
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 233, in alert_score_table
    result_df = alert_risk_scorer.alert_risk_scoring(result_df)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/alert_risk_scoring.py", line 219, in alert_risk_scoring
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/alert_risk_scoring.py", line 158, in alert_risk_scoring
    score_dfs['PRIOR_ALERT'] = prior_alert_scorer.run_prior_alert_scoring()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 121, in run_prior_alert_scoring
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 113, in run_prior_alert_scoring
    prior_alert_data_df['PRIOR_ALERT_SCORE'], prior_alert_data_df['LIST_PRIOR_ALERTS'], prior_alert_data_df['AUTO_REASON'] = zip(*prior_alert_data_df.apply(lambda row: self.prior_alert_score(row, prior_df), axis=1))
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 10374, in apply
    return op.apply().__finalize__(self, method="apply")
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 916, in apply
    return self.apply_standard()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 1063, in apply_standard
    results, res_index = self.apply_series_generator()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/apply.py", line 1081, in apply_series_generator
    results[i] = self.func(v, *self.args, **self.kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 113, in <lambda>
    prior_alert_data_df['PRIOR_ALERT_SCORE'], prior_alert_data_df['LIST_PRIOR_ALERTS'], prior_alert_data_df['AUTO_REASON'] = zip(*prior_alert_data_df.apply(lambda row: self.prior_alert_score(row, prior_df), axis=1))
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_risk_scoring/prior_alert_scoring.py", line 70, in prior_alert_score
    prior_entity_ids_str = ','.join(prior_df['ACCT_ID'].astype(str).values) if self.job_details['SCENARIO_FOCUS'] == 'ACCOUNT' else ','.join(prior_df['CUST_ID'].astype(str).values)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/range.py", line 417, in get_loc
    raise KeyError(key)
KeyError: 'ACCT_ID'
2024-10-19 12:54:14 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 12:54:14 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 12:54:15 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 12:54:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:54:19 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 12:54:19 - INFO - Pipeline execution completed successfully.
2024-10-19 12:55:37 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 12:55:37 - INFO - Starting scenario data retrieval.
2024-10-19 12:55:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:55:37 - INFO - Fetching scenario configuration data
2024-10-19 12:55:41 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 12:55:42 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 12:55:42 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:55:42 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:55:49 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 12:55:49 - INFO - Starting customer ID retrieval.
2024-10-19 12:55:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:55:54 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 12:55:54 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 12:55:54 - INFO - Starting threshold data retrieval.
2024-10-19 12:55:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:55:54 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 12:55:54 - INFO - Fetching threshold configuration data.
2024-10-19 12:55:54 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 12:55:54 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:55:58 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 12:55:58 - INFO - Threshold data fetching completed successfully.
2024-10-19 12:55:58 - INFO - Starting customer ID processing.
2024-10-19 12:55:58 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 12:56:01 - INFO - Spark session initialized successfully.
2024-10-19 12:56:01 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:56:01 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:56:01 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:56:01 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:56:40 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:56:40 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 12:57:12 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:57:12 - INFO - Fetching transaction data for 1 customers.
2024-10-19 12:57:17 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:57:37 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:57:48 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:58:02 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:58:02 - INFO - All customer chunks processed.
2024-10-19 12:58:02 - INFO - Spark session stopped.
2024-10-19 12:58:02 - INFO - Starting Parquet files processing.
2024-10-19 12:58:02 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 12:58:02 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 12:58:03 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 12:58:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:03 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:58:03 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:58:03 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:58:03 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:58:03 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:58:03 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:58:03 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:58:03 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:58:03 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:58:03 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:58:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:06 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:58:07 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:58:07 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:58:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:07 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:58:10 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:58:15 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:58:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:42 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 12:58:42 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 12:58:42 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 12:58:42 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:42 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:58:42 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:58:42 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:58:42 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:58:42 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:58:42 - INFO - No Alerts found!
2024-10-19 12:58:42 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:58:42 - INFO - No alerts generated!
2024-10-19 12:58:42 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 12:58:42 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 12:58:42 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 12:58:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:43 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:58:43 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:58:43 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:58:43 - INFO - No Alerts found!
2024-10-19 12:58:43 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:58:43 - INFO - No alerts generated!
2024-10-19 12:58:43 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 12:58:43 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 12:58:43 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 12:58:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:43 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:58:43 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:58:43 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:58:43 - INFO - No Alerts found!
2024-10-19 12:58:43 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:58:43 - INFO - No alerts generated!
2024-10-19 12:58:43 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 12:58:43 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 12:58:43 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 12:58:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:43 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:58:43 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:58:43 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:58:43 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:58:44 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 12:58:44 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 12:58:44 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 12:58:44 - INFO - Generated evidence report with 1 rows.
2024-10-19 12:58:44 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 12:58:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:47 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 12:58:47 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 12:58:47 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 12:58:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:47 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 12:58:50 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 12:58:55 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 12:58:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:58:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:13 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:22 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 12:59:22 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 12:59:22 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 12:59:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:22 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 12:59:22 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 12:59:22 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 12:59:22 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 12:59:22 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 12:59:22 - INFO - No data found for lookback period
2024-10-19 12:59:22 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 12:59:22 - INFO - No alerts generated!
2024-10-19 12:59:22 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 12:59:22 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 12:59:22 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 12:59:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 12:59:37 - ERROR - Job ID - 157 |  Error in update_job_details_status while updating job details status: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 12:59:37 - ERROR - Pipeline execution failed: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
    return self.pool.connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
pyodbc.OperationalError: ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/runner.py", line 112, in run_pipeline
    job_updater.update_job_details_status(f"{result['total_alerts']} alerts found! | Successful scenarios - {result['successful_scenarios']} | Failed scenarios - {result['failed_scenarios']}")
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/job_status_updater.py", line 143, in update_job_details_status
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/job_status_updater.py", line 136, in update_job_details_status
    job_data.to_sql(name='TS_JOB_DETAILS', con=self.sql_executor.create_engine(), if_exists='append', index=False)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 3087, in to_sql
    return sql.to_sql(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 841, in to_sql
    with pandasSQL_builder(con, schema=schema, need_transaction=True) as pandas_sql:
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 906, in pandasSQL_builder
    return SQLDatabase(con, schema, need_transaction)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 1636, in __init__
    con = self.exit_stack.enter_context(con.connect())
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3278, in connect
    return self._connection_cls(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2442, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
    return self.pool.connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
sqlalchemy.exc.OperationalError: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 14:35:47 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 14:35:47 - INFO - Starting scenario data retrieval.
2024-10-19 14:35:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:35:47 - INFO - Fetching scenario configuration data
2024-10-19 14:35:51 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 14:35:52 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 14:35:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:35:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:36:01 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 14:36:01 - INFO - Starting customer ID retrieval.
2024-10-19 14:36:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:36:07 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 14:36:07 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 14:36:07 - INFO - Starting threshold data retrieval.
2024-10-19 14:36:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:36:07 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 14:36:07 - INFO - Fetching threshold configuration data.
2024-10-19 14:36:07 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 14:36:07 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:36:12 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:36:12 - INFO - Threshold data fetching completed successfully.
2024-10-19 14:36:12 - INFO - Starting customer ID processing.
2024-10-19 14:36:12 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 14:36:16 - INFO - Spark session initialized successfully.
2024-10-19 14:36:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:36:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:36:16 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:36:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:37:01 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 14:37:01 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:37:49 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 14:37:49 - INFO - Fetching transaction data for 1 customers.
2024-10-19 14:37:52 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 14:37:57 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 14:38:47 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 14:39:26 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:39:26 - INFO - All customer chunks processed.
2024-10-19 14:39:26 - INFO - Spark session stopped.
2024-10-19 14:39:26 - INFO - Starting Parquet files processing.
2024-10-19 14:39:26 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 14:39:26 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:39:27 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 14:39:27 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:39:27 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:39:27 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:39:27 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:39:27 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:39:27 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:39:27 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 14:39:27 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 14:39:27 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 14:39:27 - ERROR - Error occurred while generating the evidence report: 'MONTH'
2024-10-19 14:39:27 - ERROR - Error processing data with ALERTCHECKER: 'MONTH'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'MONTH'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 99, in process_with_alert_checker
    evidence_table = evidence_generator.generate_evidence_report(df, alert_trxn_table)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 232, in generate_evidence_report
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 155, in generate_evidence_report
    MONTHY_SUM_DATA['TOTAL_SUMS'] = MONTHY_SUM_DATA.groupby('ACCT_ID').apply(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/groupby.py", line 1824, in apply
    result = self._python_apply_general(f, self._selected_obj)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/groupby.py", line 1885, in _python_apply_general
    values, mutated = self._grouper.apply_groupwise(f, data, self.axis)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/ops.py", line 919, in apply_groupwise
    res = f(group)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 156, in <lambda>
    lambda group: create_total_sums(group)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 147, in create_total_sums
    shifted_month = group['MONTH'].shift(-i).fillna('N/A').iloc[0]
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'MONTH'
2024-10-19 14:39:27 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 14:39:27 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 14:39:28 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 14:39:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:39:32 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 14:39:32 - INFO - Pipeline execution completed successfully.
2024-10-19 14:40:33 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 14:40:33 - INFO - Starting scenario data retrieval.
2024-10-19 14:40:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:40:33 - INFO - Fetching scenario configuration data
2024-10-19 14:40:38 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 14:40:39 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 14:40:39 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:40:39 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:40:47 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 14:40:47 - INFO - Starting customer ID retrieval.
2024-10-19 14:40:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:40:52 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 14:40:52 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 14:40:52 - INFO - Starting threshold data retrieval.
2024-10-19 14:40:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:40:52 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 14:40:52 - INFO - Fetching threshold configuration data.
2024-10-19 14:40:52 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 14:40:52 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:40:59 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:40:59 - INFO - Threshold data fetching completed successfully.
2024-10-19 14:40:59 - INFO - Starting customer ID processing.
2024-10-19 14:40:59 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 14:41:02 - INFO - Spark session initialized successfully.
2024-10-19 14:41:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:41:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:41:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:41:02 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:41:37 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 14:41:37 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:42:07 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 14:42:07 - INFO - Fetching transaction data for 1 customers.
2024-10-19 14:42:12 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 14:42:20 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 14:42:43 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:42:51 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 14:42:51 - INFO - All customer chunks processed.
2024-10-19 14:42:51 - INFO - Spark session stopped.
2024-10-19 14:42:51 - INFO - Starting Parquet files processing.
2024-10-19 14:42:51 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 14:42:51 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:42:52 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 14:42:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:42:52 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:42:52 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:42:52 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:42:52 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:42:52 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:42:52 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 14:42:52 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 14:42:52 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 14:42:52 - ERROR - Error occurred while generating the evidence report: 'MONTH'
2024-10-19 14:42:52 - ERROR - Error processing data with ALERTCHECKER: 'MONTH'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'MONTH'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 99, in process_with_alert_checker
    evidence_table = evidence_generator.generate_evidence_report(df, alert_trxn_table)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 232, in generate_evidence_report
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 155, in generate_evidence_report
    MONTHY_SUM_DATA['TOTAL_SUMS'] = MONTHY_SUM_DATA.groupby('ACCT_ID').apply(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/groupby.py", line 1824, in apply
    result = self._python_apply_general(f, self._selected_obj)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/groupby.py", line 1885, in _python_apply_general
    values, mutated = self._grouper.apply_groupwise(f, data, self.axis)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/groupby/ops.py", line 919, in apply_groupwise
    res = f(group)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 156, in <lambda>
    lambda group: create_total_sums(group)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 147, in create_total_sums
    shifted_month = group['MONTH'].shift(-i).fillna('N/A').iloc[0]
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'MONTH'
2024-10-19 14:42:52 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 14:42:52 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 14:42:53 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 14:42:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:42:59 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 14:42:59 - INFO - Pipeline execution completed successfully.
2024-10-19 14:48:18 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 14:48:18 - INFO - Starting scenario data retrieval.
2024-10-19 14:48:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:48:18 - INFO - Fetching scenario configuration data
2024-10-19 14:48:22 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 14:48:24 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 14:48:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:48:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:48:31 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 14:48:31 - INFO - Starting customer ID retrieval.
2024-10-19 14:48:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:48:37 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 14:48:37 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 14:48:37 - INFO - Starting threshold data retrieval.
2024-10-19 14:48:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:48:37 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 14:48:37 - INFO - Fetching threshold configuration data.
2024-10-19 14:48:37 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 14:48:37 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:48:42 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 14:48:42 - INFO - Threshold data fetching completed successfully.
2024-10-19 14:48:42 - INFO - Starting customer ID processing.
2024-10-19 14:48:42 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 14:48:45 - INFO - Spark session initialized successfully.
2024-10-19 14:48:45 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:48:45 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:48:45 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:48:45 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:49:51 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 14:49:51 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 14:50:15 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 14:50:15 - INFO - Fetching transaction data for 1 customers.
2024-10-19 14:50:18 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 14:50:43 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 14:50:45 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 14:51:19 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:51:19 - INFO - All customer chunks processed.
2024-10-19 14:51:19 - INFO - Spark session stopped.
2024-10-19 14:51:19 - INFO - Starting Parquet files processing.
2024-10-19 14:51:19 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 14:51:19 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 14:51:20 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 14:51:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:20 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:51:20 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:51:20 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:51:20 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:51:20 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:51:20 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 14:51:20 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 14:51:20 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 14:51:20 - INFO - Generated evidence report with 1 rows.
2024-10-19 14:51:20 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 14:51:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:24 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 14:51:24 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 14:51:24 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 14:51:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:24 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 14:51:28 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 14:51:31 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 14:51:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:40 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:51:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:00 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 14:52:00 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 14:52:00 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 14:52:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:00 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:52:00 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:52:00 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:52:00 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:52:00 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:52:01 - INFO - No Alerts found!
2024-10-19 14:52:01 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 14:52:01 - INFO - No alerts generated!
2024-10-19 14:52:01 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 14:52:01 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 14:52:01 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 14:52:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:01 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:52:01 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:52:01 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:52:01 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:52:01 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:52:01 - INFO - No Alerts found!
2024-10-19 14:52:01 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 14:52:01 - INFO - No alerts generated!
2024-10-19 14:52:01 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 14:52:01 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 14:52:01 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 14:52:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:01 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:52:01 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:52:01 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:52:01 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:52:01 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:52:01 - INFO - No Alerts found!
2024-10-19 14:52:01 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 14:52:01 - INFO - No alerts generated!
2024-10-19 14:52:01 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 14:52:01 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 14:52:02 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 14:52:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:02 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 14:52:02 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 14:52:02 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 14:52:02 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 14:52:02 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 14:52:02 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 14:52:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 14:52:02 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 14:52:02 - INFO - Generated evidence report with 1 rows.
2024-10-19 14:52:02 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 14:52:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:05 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 14:52:05 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 14:52:05 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 14:52:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:05 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 14:52:10 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 14:52:14 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 14:52:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:37 - ERROR - Error: An error occurred while pushing alert transaction data - (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 14:52:37 - ERROR - Error while pushing alert data: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 14:52:37 - ERROR - Error processing data with ALERTCHECKER: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
    return self.pool.connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
pyodbc.OperationalError: ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 112, in process_with_alert_checker
    alert_pusher.push_alerts(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/data_pusher.py", line 346, in push_alerts
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/data_pusher.py", line 331, in push_alerts
    alert_id_mapping_dict = self.push_alert_trxn_data(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/data_pusher.py", line 186, in push_alert_trxn_data
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_pusher/data_pusher.py", line 173, in push_alert_trxn_data
    chunk.to_sql(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 3087, in to_sql
    return sql.to_sql(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 841, in to_sql
    with pandasSQL_builder(con, schema=schema, need_transaction=True) as pandas_sql:
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 906, in pandasSQL_builder
    return SQLDatabase(con, schema, need_transaction)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/sql.py", line 1636, in __init__
    con = self.exit_stack.enter_context(con.connect())
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3278, in connect
    return self._connection_cls(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2442, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 3302, in raw_connection
    return self.pool.connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 1263, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 712, in checkout
    rec = pool._do_get()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 179, in _do_get
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/impl.py", line 177, in _do_get
    return self._create_connection()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 674, in __init__
    self.__connect()
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 900, in __connect
    with util.safe_reraise():
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 896, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 643, in connect
    return dialect.connect(*cargs, **cparams)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 621, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
sqlalchemy.exc.OperationalError: (pyodbc.OperationalError) ('HYT00', '[HYT00] [Microsoft][ODBC Driver 17 for SQL Server]Login timeout expired (0) (SQLDriverConnect)')
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-10-19 14:52:37 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 14:52:37 - INFO - All data fetched: 915730 transactions | Total unique customers: 124753
2024-10-19 14:52:38 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 14:52:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 14:52:42 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 14:52:42 - INFO - Pipeline execution completed successfully.
2024-10-19 15:08:29 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 15:08:29 - INFO - Starting scenario data retrieval.
2024-10-19 15:08:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:08:29 - INFO - Fetching scenario configuration data
2024-10-19 15:08:34 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 15:08:36 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 15:08:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:08:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:08:44 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 15:08:44 - INFO - Starting customer ID retrieval.
2024-10-19 15:08:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:08:50 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 15:08:50 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 15:08:50 - INFO - Starting threshold data retrieval.
2024-10-19 15:08:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:08:50 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 15:08:50 - INFO - Fetching threshold configuration data.
2024-10-19 15:08:50 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 15:08:50 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:08:54 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:08:54 - INFO - Threshold data fetching completed successfully.
2024-10-19 15:08:54 - INFO - Starting customer ID processing.
2024-10-19 15:08:54 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 15:08:58 - INFO - Spark session initialized successfully.
2024-10-19 15:08:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:08:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:08:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:08:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:10:06 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:10:06 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:10:16 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:10:16 - INFO - Fetching transaction data for 1 customers.
2024-10-19 15:10:19 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:10:37 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:10:46 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:11:04 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:11:04 - INFO - All customer chunks processed.
2024-10-19 15:11:04 - INFO - Spark session stopped.
2024-10-19 15:11:04 - INFO - Starting Parquet files processing.
2024-10-19 15:11:04 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 15:11:04 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:11:05 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 15:11:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:05 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:11:05 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:11:05 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:11:05 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:11:05 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:11:05 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:11:05 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:11:05 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:11:06 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:11:06 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:11:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:10 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:11:10 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:11:10 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:11:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:10 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:11:14 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:11:20 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:11:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:41 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:46 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:51 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 15:11:51 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:11:51 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 15:11:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:51 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:11:51 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:11:51 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:11:51 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:11:51 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:11:51 - INFO - No Alerts found!
2024-10-19 15:11:51 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:11:51 - INFO - No alerts generated!
2024-10-19 15:11:51 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 15:11:51 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:11:52 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 15:11:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:52 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:11:52 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:11:52 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:11:52 - INFO - No Alerts found!
2024-10-19 15:11:52 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:11:52 - INFO - No alerts generated!
2024-10-19 15:11:52 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 15:11:52 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:11:52 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 15:11:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:52 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:11:52 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:11:52 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:11:52 - INFO - No Alerts found!
2024-10-19 15:11:52 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:11:52 - INFO - No alerts generated!
2024-10-19 15:11:52 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 15:11:52 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:11:52 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 15:11:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:52 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:11:52 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:11:52 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:11:52 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:11:53 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:11:53 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:11:53 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:11:53 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:11:53 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:11:53 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:56 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:11:57 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:11:57 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:11:57 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:11:57 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:12:01 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:12:06 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:12:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:16 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:21 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:38 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 15:12:38 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:12:38 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 15:12:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:38 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:12:38 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:12:38 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:12:38 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:12:38 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:12:38 - INFO - No data found for lookback period
2024-10-19 15:12:38 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:12:38 - INFO - No alerts generated!
2024-10-19 15:12:38 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 15:12:38 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 15:12:38 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 15:12:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:12:44 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 15:12:44 - INFO - Pipeline execution completed successfully.
2024-10-19 15:21:58 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 15:21:58 - INFO - Starting scenario data retrieval.
2024-10-19 15:21:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:21:58 - INFO - Fetching scenario configuration data
2024-10-19 15:22:03 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 15:22:04 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 15:22:04 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:22:04 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:22:12 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 15:22:12 - INFO - Starting customer ID retrieval.
2024-10-19 15:22:12 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:22:18 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 15:22:18 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 15:22:18 - INFO - Starting threshold data retrieval.
2024-10-19 15:22:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:22:18 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 15:22:18 - INFO - Fetching threshold configuration data.
2024-10-19 15:22:18 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 15:22:18 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:22:22 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:22:22 - INFO - Threshold data fetching completed successfully.
2024-10-19 15:22:22 - INFO - Starting customer ID processing.
2024-10-19 15:22:22 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 15:22:25 - INFO - Spark session initialized successfully.
2024-10-19 15:22:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:22:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:22:26 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:22:26 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:23:47 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:23:47 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:23:51 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:23:51 - INFO - Fetching transaction data for 1 customers.
2024-10-19 15:23:55 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:24:21 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:24:35 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:24:49 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:24:49 - INFO - All customer chunks processed.
2024-10-19 15:24:49 - INFO - Spark session stopped.
2024-10-19 15:24:49 - INFO - Starting Parquet files processing.
2024-10-19 15:24:49 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 15:24:49 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:24:49 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 15:24:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:24:50 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:24:50 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:24:50 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:24:50 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:24:50 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:24:50 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:24:50 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:24:50 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:24:50 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:24:50 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:24:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:24:54 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:24:54 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:24:54 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:24:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:24:54 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:24:58 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:25:03 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:25:03 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:12 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:28 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:34 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 15:25:34 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:25:34 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 15:25:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:34 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:25:34 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:25:34 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:25:34 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:25:34 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:25:34 - INFO - No Alerts found!
2024-10-19 15:25:34 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:25:34 - INFO - No alerts generated!
2024-10-19 15:25:34 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 15:25:34 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:25:34 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 15:25:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:34 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:25:34 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:25:34 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:25:34 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:25:34 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:25:34 - INFO - No Alerts found!
2024-10-19 15:25:34 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:25:34 - INFO - No alerts generated!
2024-10-19 15:25:34 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 15:25:34 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:25:35 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 15:25:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:35 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:25:35 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:25:35 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:25:35 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:25:35 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:25:35 - INFO - No Alerts found!
2024-10-19 15:25:35 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:25:35 - INFO - No alerts generated!
2024-10-19 15:25:35 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 15:25:35 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:25:35 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 15:25:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:35 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:25:35 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:25:35 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:25:35 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:25:35 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:25:35 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:25:35 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:25:35 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:25:35 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:25:35 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:25:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:40 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:25:40 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:25:40 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:25:40 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:40 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:25:44 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:25:48 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:25:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:25:57 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:19 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 15:26:19 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:26:19 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 15:26:19 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:19 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:26:19 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:26:19 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:26:19 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:26:19 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:26:19 - INFO - No data found for lookback period
2024-10-19 15:26:19 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:26:19 - INFO - No alerts generated!
2024-10-19 15:26:19 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 15:26:19 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 15:26:20 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 15:26:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:26:24 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 15:26:24 - INFO - Pipeline execution completed successfully.
2024-10-19 15:32:07 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 15:32:07 - INFO - Starting scenario data retrieval.
2024-10-19 15:32:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:32:07 - INFO - Fetching scenario configuration data
2024-10-19 15:32:12 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 15:32:13 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 15:32:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:32:14 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:32:21 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 15:32:21 - INFO - Starting customer ID retrieval.
2024-10-19 15:32:21 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:32:26 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 15:32:26 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 15:32:26 - INFO - Starting threshold data retrieval.
2024-10-19 15:32:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:32:26 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 15:32:26 - INFO - Fetching threshold configuration data.
2024-10-19 15:32:26 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 15:32:26 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:32:30 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:32:31 - INFO - Threshold data fetching completed successfully.
2024-10-19 15:32:31 - INFO - Starting customer ID processing.
2024-10-19 15:32:31 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 15:32:33 - INFO - Spark session initialized successfully.
2024-10-19 15:32:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:32:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:32:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:32:34 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:33:58 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:33:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:34:17 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:34:17 - INFO - Fetching transaction data for 1 customers.
2024-10-19 15:34:21 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:34:45 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:34:58 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:35:03 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:35:03 - INFO - All customer chunks processed.
2024-10-19 15:35:03 - INFO - Spark session stopped.
2024-10-19 15:35:03 - INFO - Starting Parquet files processing.
2024-10-19 15:35:03 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 15:35:03 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:35:04 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 15:35:04 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:35:04 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:35:04 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:35:04 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:35:04 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:35:04 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:35:04 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:35:04 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:35:04 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:35:04 - ERROR - Error occurred while generating the evidence report: No module named 'openpyxl'
2024-10-19 15:35:04 - ERROR - Error processing data with ALERTCHECKER: No module named 'openpyxl'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 99, in process_with_alert_checker
    evidence_table = evidence_generator.generate_evidence_report(df, alert_trxn_table)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 233, in generate_evidence_report
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 216, in generate_evidence_report
    evidence_data_df.to_excel('Unagg_Evidence-TS_SCN_30.xlsx', index=False)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 2417, in to_excel
    formatter.write(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/formats/excel.py", line 943, in write
    writer = ExcelWriter(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/excel/_openpyxl.py", line 57, in __init__
    from openpyxl.workbook import Workbook
ModuleNotFoundError: No module named 'openpyxl'
2024-10-19 15:35:04 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 15:35:04 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 15:35:05 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 15:35:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:35:09 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 15:35:09 - INFO - Pipeline execution completed successfully.
2024-10-19 15:36:38 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 15:36:38 - INFO - Starting scenario data retrieval.
2024-10-19 15:36:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:36:38 - INFO - Fetching scenario configuration data
2024-10-19 15:36:42 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 15:36:43 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 15:36:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:36:43 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:36:50 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 15:36:50 - INFO - Starting customer ID retrieval.
2024-10-19 15:36:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:37:07 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 15:37:07 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 15:37:07 - INFO - Starting threshold data retrieval.
2024-10-19 15:37:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:37:07 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 15:37:07 - INFO - Fetching threshold configuration data.
2024-10-19 15:37:07 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 15:37:07 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:37:10 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:37:11 - INFO - Threshold data fetching completed successfully.
2024-10-19 15:37:11 - INFO - Starting customer ID processing.
2024-10-19 15:37:11 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 15:37:19 - INFO - Spark session initialized successfully.
2024-10-19 15:37:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:37:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:37:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:37:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:38:17 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:38:17 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:38:36 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:38:36 - INFO - Fetching transaction data for 1 customers.
2024-10-19 15:38:40 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:39:19 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:39:29 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:39:29 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:39:29 - INFO - All customer chunks processed.
2024-10-19 15:39:30 - INFO - Spark session stopped.
2024-10-19 15:39:30 - INFO - Starting Parquet files processing.
2024-10-19 15:39:30 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 15:39:30 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:39:30 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 15:39:30 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:39:30 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:39:30 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:39:30 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:39:30 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:39:30 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:39:31 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:39:31 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:39:31 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:39:31 - ERROR - Error occurred while generating the evidence report: No module named 'openpyxl'
2024-10-19 15:39:31 - ERROR - Error processing data with ALERTCHECKER: No module named 'openpyxl'
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 99, in process_with_alert_checker
    evidence_table = evidence_generator.generate_evidence_report(df, alert_trxn_table)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 233, in generate_evidence_report
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 216, in generate_evidence_report
    evidence_data_df.to_excel('Unagg_Evidence-TS_SCN_30.xlsx', index=False)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 2417, in to_excel
    formatter.write(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/formats/excel.py", line 943, in write
    writer = ExcelWriter(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/io/excel/_openpyxl.py", line 57, in __init__
    from openpyxl.workbook import Workbook
ModuleNotFoundError: No module named 'openpyxl'
2024-10-19 15:39:31 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 15:39:31 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 15:39:31 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 15:39:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:39:36 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 15:39:36 - INFO - Pipeline execution completed successfully.
2024-10-19 15:40:24 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 15:40:24 - INFO - Starting scenario data retrieval.
2024-10-19 15:40:24 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:40:24 - INFO - Fetching scenario configuration data
2024-10-19 15:40:28 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 15:40:29 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 15:40:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:40:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:40:36 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 15:40:36 - INFO - Starting customer ID retrieval.
2024-10-19 15:40:36 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:40:49 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 15:40:49 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 15:40:49 - INFO - Starting threshold data retrieval.
2024-10-19 15:40:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:40:49 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 15:40:49 - INFO - Fetching threshold configuration data.
2024-10-19 15:40:49 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 15:40:49 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:40:52 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 15:40:53 - INFO - Threshold data fetching completed successfully.
2024-10-19 15:40:53 - INFO - Starting customer ID processing.
2024-10-19 15:40:53 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 15:40:56 - INFO - Spark session initialized successfully.
2024-10-19 15:40:56 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:40:56 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:40:56 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:40:56 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:42:08 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:42:08 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 15:42:15 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:42:15 - INFO - Fetching transaction data for 1 customers.
2024-10-19 15:42:18 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:42:38 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:43:06 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:43:06 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:43:06 - INFO - All customer chunks processed.
2024-10-19 15:43:07 - INFO - Spark session stopped.
2024-10-19 15:43:07 - INFO - Starting Parquet files processing.
2024-10-19 15:43:07 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 15:43:07 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 15:43:07 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 15:43:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:08 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:43:08 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:43:08 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:43:08 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:43:08 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:43:08 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:43:08 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:43:08 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:43:08 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:43:08 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:43:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:13 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:43:13 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:43:13 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:43:13 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:13 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:43:17 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:43:21 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:43:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:30 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:39 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:45 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:49 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 15:43:49 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 15:43:49 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 15:43:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:49 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:43:49 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:43:49 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:43:49 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:43:49 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:43:49 - INFO - No Alerts found!
2024-10-19 15:43:49 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:43:49 - INFO - No alerts generated!
2024-10-19 15:43:49 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 15:43:49 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 15:43:50 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 15:43:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:50 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:43:50 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:43:50 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:43:50 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:43:50 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:43:50 - INFO - No Alerts found!
2024-10-19 15:43:50 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:43:50 - INFO - No alerts generated!
2024-10-19 15:43:50 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 15:43:50 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 15:43:50 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 15:43:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:50 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:43:50 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:43:50 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:43:50 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:43:50 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:43:50 - INFO - No Alerts found!
2024-10-19 15:43:50 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:43:50 - INFO - No alerts generated!
2024-10-19 15:43:50 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 15:43:50 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 15:43:51 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 15:43:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:51 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:43:51 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:43:51 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:43:51 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:43:51 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:43:51 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 15:43:51 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 15:43:51 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 15:43:51 - INFO - Generated evidence report with 1 rows.
2024-10-19 15:43:51 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 15:43:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:55 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 15:43:55 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 15:43:55 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 15:43:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:43:55 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 15:43:58 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 15:44:02 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 15:44:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:06 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:11 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:22 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:27 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:31 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 15:44:31 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 15:44:31 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 15:44:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:31 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 15:44:31 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 15:44:31 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 15:44:31 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 15:44:31 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 15:44:31 - INFO - No data found for lookback period
2024-10-19 15:44:31 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 15:44:31 - INFO - No alerts generated!
2024-10-19 15:44:31 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 15:44:31 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 15:44:31 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 15:44:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 15:44:36 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 15:44:36 - INFO - Pipeline execution completed successfully.
2024-10-19 16:08:50 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 16:08:50 - INFO - Starting scenario data retrieval.
2024-10-19 16:08:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:08:50 - INFO - Fetching scenario configuration data
2024-10-19 16:08:55 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 16:08:56 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 16:08:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:08:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:09:05 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 16:09:05 - INFO - Starting customer ID retrieval.
2024-10-19 16:09:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:09:11 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 16:09:12 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 16:09:12 - INFO - Starting threshold data retrieval.
2024-10-19 16:09:12 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:09:12 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 16:09:12 - INFO - Fetching threshold configuration data.
2024-10-19 16:09:12 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 16:09:12 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:09:16 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:09:16 - INFO - Threshold data fetching completed successfully.
2024-10-19 16:09:16 - INFO - Starting customer ID processing.
2024-10-19 16:09:16 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 16:09:19 - INFO - Spark session initialized successfully.
2024-10-19 16:09:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:09:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:09:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:09:19 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:09:58 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 16:09:58 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:10:02 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 16:10:02 - INFO - Fetching transaction data for 1 customers.
2024-10-19 16:10:05 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 16:10:16 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 16:10:32 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:10:47 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 16:10:47 - INFO - All customer chunks processed.
2024-10-19 16:10:48 - INFO - Spark session stopped.
2024-10-19 16:10:48 - INFO - Starting Parquet files processing.
2024-10-19 16:10:48 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 16:10:48 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:10:48 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 16:10:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:10:48 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:10:48 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:10:48 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:10:48 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:10:48 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:10:49 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:10:49 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:10:49 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:10:49 - ERROR - Error occurred while generating the evidence report: "['TRXN_EXCN_DT', 'MONTHY_SUM'] not found in axis"
2024-10-19 16:10:49 - ERROR - Error processing data with ALERTCHECKER: "['TRXN_EXCN_DT', 'MONTHY_SUM'] not found in axis"
Traceback (most recent call last):
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/scenario_manager.py", line 99, in process_with_alert_checker
    evidence_table = evidence_generator.generate_evidence_report(df, alert_trxn_table)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 232, in generate_evidence_report
    raise e
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/TS_TRXN_MONITORING_SPARK/ts_scenarios/TS_SCN_30/generate_evidence.py", line 162, in generate_evidence_report
    final_result = final_result.drop(columns=['TRXN_EXCN_DT', 'MONTHY_SUM'])
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/frame.py", line 5581, in drop
    return super().drop(
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 4788, in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/generic.py", line 4830, in _drop_axis
    new_axis = axis.drop(labels, errors=errors)
  File "/home/hackit/Desktop/TM/SCENARIO_SPARK/scenarioenv/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 7070, in drop
    raise KeyError(f"{labels[mask].tolist()} not found in axis")
KeyError: "['TRXN_EXCN_DT', 'MONTHY_SUM'] not found in axis"
2024-10-19 16:10:49 - ERROR - Error processing Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 16:10:49 - INFO - All data fetched: 303341 transactions | Total unique customers: 24995
2024-10-19 16:10:49 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 16:10:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:10:55 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 16:10:55 - INFO - Pipeline execution completed successfully.
2024-10-19 16:12:48 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 16:12:48 - INFO - Starting scenario data retrieval.
2024-10-19 16:12:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:12:48 - INFO - Fetching scenario configuration data
2024-10-19 16:12:53 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 16:12:54 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 16:12:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:12:54 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:04 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 16:13:04 - INFO - Starting customer ID retrieval.
2024-10-19 16:13:04 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:13 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 16:13:13 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 16:13:13 - INFO - Starting threshold data retrieval.
2024-10-19 16:13:13 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:13 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 16:13:13 - INFO - Fetching threshold configuration data.
2024-10-19 16:13:13 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 16:13:13 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:13:17 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:13:17 - INFO - Threshold data fetching completed successfully.
2024-10-19 16:13:17 - INFO - Starting customer ID processing.
2024-10-19 16:13:17 - INFO - Starting Parquet files processing.
2024-10-19 16:13:17 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 16:13:17 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:13:18 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 16:13:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:18 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:13:18 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:13:18 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:13:18 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:13:18 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:13:18 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:13:18 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:13:18 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:13:18 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:13:18 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:13:18 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:23 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:13:23 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:13:23 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:13:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:23 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:13:28 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:13:34 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:13:34 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:38 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:44 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:48 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:13:55 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:01 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:08 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 16:14:08 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 16:14:08 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 16:14:08 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:08 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:14:08 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:14:08 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:14:08 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:14:08 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:14:08 - INFO - No Alerts found!
2024-10-19 16:14:08 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:14:08 - INFO - No alerts generated!
2024-10-19 16:14:08 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 16:14:08 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 16:14:09 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 16:14:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:09 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:14:09 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:14:09 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:14:09 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:14:09 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:14:09 - INFO - No Alerts found!
2024-10-19 16:14:09 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:14:09 - INFO - No alerts generated!
2024-10-19 16:14:09 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 16:14:09 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 16:14:09 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 16:14:09 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:09 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:14:09 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:14:09 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:14:09 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:14:09 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:14:09 - INFO - No Alerts found!
2024-10-19 16:14:09 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:14:09 - INFO - No alerts generated!
2024-10-19 16:14:09 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 16:14:09 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 16:14:10 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 16:14:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:10 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:14:10 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:14:10 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:14:10 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:14:10 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:14:10 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:14:10 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:14:10 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:14:10 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:14:10 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:14:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:15 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:14:15 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:14:15 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:14:15 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:15 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:14:19 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:14:25 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:14:25 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:41 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:49 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:14:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:15:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 16:15:02 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 16:15:02 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 16:15:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:15:02 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:15:02 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:15:02 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:15:02 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:15:02 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:15:02 - INFO - No data found for lookback period
2024-10-19 16:15:02 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:15:02 - INFO - No alerts generated!
2024-10-19 16:15:02 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 16:15:02 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 16:15:02 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 16:15:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:15:08 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 16:15:08 - INFO - Pipeline execution completed successfully.
2024-10-19 16:47:17 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 16:47:17 - INFO - Starting scenario data retrieval.
2024-10-19 16:47:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:17 - INFO - Fetching scenario configuration data
2024-10-19 16:47:21 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 16:47:23 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 16:47:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:23 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:31 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 16:47:31 - INFO - Starting customer ID retrieval.
2024-10-19 16:47:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:41 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 16:47:41 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 16:47:41 - INFO - Starting threshold data retrieval.
2024-10-19 16:47:41 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:41 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 16:47:41 - INFO - Fetching threshold configuration data.
2024-10-19 16:47:41 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 16:47:41 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:47:44 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:47:45 - INFO - Threshold data fetching completed successfully.
2024-10-19 16:47:45 - INFO - Starting customer ID processing.
2024-10-19 16:47:45 - INFO - Starting Parquet files processing.
2024-10-19 16:47:45 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 16:47:45 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:47:45 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 16:47:45 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:45 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:47:45 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:47:45 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:47:45 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:47:45 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:47:46 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:47:46 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:47:46 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:47:46 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:47:46 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:47:46 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:49 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:47:50 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:47:50 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:47:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:47:50 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:47:54 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:47:59 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:47:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:02 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:07 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:13 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:21 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:31 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 16:48:31 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 16:48:31 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 16:48:31 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:31 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:48:31 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:48:31 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:48:31 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:48:31 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:48:31 - INFO - No Alerts found!
2024-10-19 16:48:31 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:48:31 - INFO - No alerts generated!
2024-10-19 16:48:31 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 16:48:31 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 16:48:32 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 16:48:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:32 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:48:32 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:48:32 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:48:32 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:48:32 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:48:32 - INFO - No Alerts found!
2024-10-19 16:48:32 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:48:32 - INFO - No alerts generated!
2024-10-19 16:48:32 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 16:48:32 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 16:48:32 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 16:48:32 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:32 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:48:32 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:48:32 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:48:32 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:48:32 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:48:32 - INFO - No Alerts found!
2024-10-19 16:48:32 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:48:32 - INFO - No alerts generated!
2024-10-19 16:48:32 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 16:48:32 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 16:48:33 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 16:48:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:33 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:48:33 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:48:33 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:48:33 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:48:33 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:48:33 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:48:33 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:48:33 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:48:33 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:48:33 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:48:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:37 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:48:37 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:48:37 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:48:37 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:37 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:48:41 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:48:46 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:48:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:50 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:48:56 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:49:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:49:47 - INFO - Received request to start pipeline with details: {'JOB_ID': 157, 'SCENARIO_IDS': ['TS_SCN_30'], 'TRIGGER_BY': 3, 'IS_MANUAL_JOB': True}
2024-10-19 16:49:47 - INFO - Starting scenario data retrieval.
2024-10-19 16:49:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:49:47 - INFO - Fetching scenario configuration data
2024-10-19 16:49:51 - INFO - Successfully executed query: 
        SELECT
            TS_SCENARIO.SCENARIO_ID,
            TS_SCENARIO.SCENARIO_NM,
            TS_SCENARIO.ALERT_TYPE_ID,
            TS_SCENARIO.SCENARIO_FOCUS,
            TS_SCENARIO.SCENARIO_FREQUENCY,
            TS_SCENARIO.STATUS_ID AS SCENARIO_STATUS_ID,
            TS_SCENARIO.THRESHOLD_LEVEL_FL,
            TS_SCN_CONFIG.CONFIG_ID,
            TS_SCN_CONFIG.SQL_TX,
            TS_SCN_CONFIG.CONFIG_TYPE_CD,
            TS_SCN_CONFIG.STATUS_ID AS CONFIG_STATUS_ID,
            SCENARIO_STATUS.STATUS_NAME AS SCENARIO_STATUS_NAME,
            CONFIG_STATUS.STATUS_NAME AS CONFIG_STATUS_NAME,
            THRESHOLD_LEVEL_STATUS.STATUS_NAME AS THRESHOLD_STATUS_NAME
        FROM TS_SCENARIO
        LEFT JOIN TS_SCN_CONFIG ON TS_SCENARIO.SCENARIO_ID = TS_SCN_CONFIG.SCENARIO_ID
        LEFT JOIN TS_STATUS AS SCENARIO_STATUS ON TS_SCENARIO.STATUS_ID = SCENARIO_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS THRESHOLD_LEVEL_STATUS ON TS_SCENARIO.THRESHOLD_LEVEL_FL = THRESHOLD_LEVEL_STATUS.STATUS_ID
        LEFT JOIN TS_STATUS AS CONFIG_STATUS ON TS_SCN_CONFIG.STATUS_ID = CONFIG_STATUS.STATUS_ID
        WHERE TS_SCENARIO.SCENARIO_ID IN ('TS_SCN_30')
        
2024-10-19 16:49:52 - INFO - Successfully executed query: SELECT JOB_NAME FROM TS_JOB_RUN WHERE JOB_ID = 157
2024-10-19 16:49:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:49:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:50:00 - INFO - Job ID - 157 | Job Monitor Details Status updated to RUNNING
2024-10-19 16:50:00 - INFO - Starting customer ID retrieval.
2024-10-19 16:50:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:50:17 - INFO - Successfully executed query: SELECT CUST_ID FROM TS_CUST ORDER BY CUST_ID
2024-10-19 16:50:17 - INFO - Successfully fetched 125001 customer IDs.
2024-10-19 16:50:17 - INFO - Starting threshold data retrieval.
2024-10-19 16:50:17 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:50:17 - INFO - SQLQueryExecutor initialized successfully.
2024-10-19 16:50:17 - INFO - Fetching threshold configuration data.
2024-10-19 16:50:17 - DEBUG - Processing scenario ID: TS_SCN_30
2024-10-19 16:50:17 - DEBUG - Executing SQL query for scenario ID TS_SCN_30: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:50:21 - INFO - Successfully executed query: 
    SELECT
        TS_THRESHOLD_SET.THRESHOLD_SET_ID,
        TS_THRESHOLD.THRESHOLD_VALUE,
        TS_THRESHOLD_TYPE.DPLY_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_NM,
        TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID,
        TS_THRESHOLD_TYPE.SCENARIO_ID
    FROM TS_THRESHOLD_SET
    JOIN TS_THRESHOLD ON TS_THRESHOLD_SET.THRESHOLD_SET_ID = TS_THRESHOLD.THRESHOLD_SET_ID
    JOIN TS_THRESHOLD_TYPE ON TS_THRESHOLD_TYPE.SCENARIO_ID = TS_THRESHOLD_SET.SCENARIO_ID
    AND TS_THRESHOLD_TYPE.THRESHOLD_TYPE_ID = TS_THRESHOLD.THRESHOLD_TYPE_ID
    WHERE TS_THRESHOLD_TYPE.SCENARIO_ID = 'TS_SCN_30'
     AND IS_ACTIVE = 1
2024-10-19 16:50:22 - INFO - Threshold data fetching completed successfully.
2024-10-19 16:50:22 - INFO - Starting customer ID processing.
2024-10-19 16:50:22 - INFO - Initializing Spark session with JDBC configurations.
2024-10-19 16:50:25 - INFO - Spark session initialized successfully.
2024-10-19 16:50:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:50:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:50:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:50:25 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:50:54 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 16:50:54 - INFO - Fetching transaction data for 25000 customers.
2024-10-19 16:51:11 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 16:51:11 - INFO - Fetching transaction data for 1 customers.
2024-10-19 16:51:14 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 16:51:27 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 16:51:37 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 16:52:09 - INFO - Data saved to Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:52:09 - INFO - All customer chunks processed.
2024-10-19 16:52:10 - INFO - Spark session stopped.
2024-10-19 16:52:10 - INFO - Starting Parquet files processing.
2024-10-19 16:52:10 - INFO - Processing up to 6 Parquet files in directory: Parquet_Data/157/
2024-10-19 16:52:10 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_0.parquet
2024-10-19 16:52:10 - INFO - Fetched 303341 transactions | Total unique customers: 24995
2024-10-19 16:52:10 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:10 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:52:10 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:52:10 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:52:10 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:52:10 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:52:11 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:52:11 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:52:11 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:52:11 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:52:11 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:52:11 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:15 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:52:16 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:52:16 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:52:16 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:16 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:52:20 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1480617963')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:52:26 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:52:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:29 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:35 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:40 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:47 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:52 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:58 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_0.parquet with scenario ID TS_SCN_30
2024-10-19 16:52:58 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_1.parquet
2024-10-19 16:52:58 - INFO - Fetched 150729 transactions | Total unique customers: 49966
2024-10-19 16:52:58 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:58 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:52:58 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:52:58 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:52:58 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:52:58 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:52:58 - INFO - No Alerts found!
2024-10-19 16:52:58 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:52:58 - INFO - No alerts generated!
2024-10-19 16:52:58 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_1.parquet with scenario ID TS_SCN_30
2024-10-19 16:52:58 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_2.parquet
2024-10-19 16:52:59 - INFO - Fetched 149887 transactions | Total unique customers: 74931
2024-10-19 16:52:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:59 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:52:59 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:52:59 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:52:59 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:52:59 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:52:59 - INFO - No Alerts found!
2024-10-19 16:52:59 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:52:59 - INFO - No alerts generated!
2024-10-19 16:52:59 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_2.parquet with scenario ID TS_SCN_30
2024-10-19 16:52:59 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_3.parquet
2024-10-19 16:52:59 - INFO - Fetched 155762 transactions | Total unique customers: 99859
2024-10-19 16:52:59 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:52:59 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:52:59 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:52:59 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:52:59 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:52:59 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:52:59 - INFO - No Alerts found!
2024-10-19 16:52:59 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:52:59 - INFO - No alerts generated!
2024-10-19 16:52:59 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_3.parquet with scenario ID TS_SCN_30
2024-10-19 16:52:59 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_4.parquet
2024-10-19 16:53:00 - INFO - Fetched 156011 transactions | Total unique customers: 124753
2024-10-19 16:53:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:00 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:53:00 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:53:00 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:53:00 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:53:00 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:53:00 - INFO - Job ID - 157 | Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) | Total no. of alerts found - 1
2024-10-19 16:53:00 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 1
2024-10-19 16:53:00 - INFO - Generated alert transaction table with 2 rows.
2024-10-19 16:53:00 - INFO - Generated evidence report with 1 rows.
2024-10-19 16:53:00 - INFO - Generated alert customer account mapping table with 1 rows.
2024-10-19 16:53:00 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:05 - INFO - Successfully executed query: 
                SELECT
    A.ATTR_ID,
    A.ATTR_NM,
    S.SCR_GRP_TYPE,
    S.WEIGHTAGE,
    V.MIN_VALUE,
    V.MAX_VALUE,
    V.ATTR_SCORE
FROM
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR] A
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_ATTR_VAL] V ON A.ATTR_ID = V.SCR_ATTR_ID
LEFT JOIN
[TS_STAR].[dbo].[TS_ALERT_SCR_GRP] S ON A.SCR_GRP_ID = S.SCR_GRP_ID

                WHERE
                A.SCENARIO_ID = 'TS_SCN_30'
                AND (A.IS_ACTIVE IS NULL OR A.IS_ACTIVE = 'true');
            
2024-10-19 16:53:05 - INFO - Job ID - 157 | Alert Scoring attributes dictionary created successfully!
2024-10-19 16:53:05 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) AlertRiskScoring has been initialized.
2024-10-19 16:53:05 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:05 - INFO - Unusual CASH Transfer Activity Exceeding (Risk %) and ($ Threshold) : calculating Prior Alert Scores.
2024-10-19 16:53:10 - INFO - Successfully executed query: 
                    SELECT
    TS_ALERT.ALERT_ID,
    TS_ALERT.ALERT_TX,
    TS_ALERT.PREV_MATCH_CT_ALL,
    TS_ALERT.PREV_MATCH_CT,
    TS_ALERT.SCENARIO_ID,
    UPPER(TS_STATUS.STATUS) AS STATUS_CD,
    --TS_ALERT_CUST
    TS_ALERT_CUST.CUST_ID,
    TS_ALERT_CUST.ACCT_ID,

    TS_ALERT_INVGTN.AUTO_REASN_FL,
    TS_ALERT_CASE.ALERT_INVSTN_ID,
    TS_SAR_CASE.CASE_ID,
    TS_SAR.SAR_ID
FROM
    TS_ALERT
LEFT JOIN
    TS_ALERT_CUST ON TS_ALERT.ALERT_ID = TS_ALERT_CUST.ALERT_ID
LEFT JOIN
    TS_ALERT_INVGTN ON TS_ALERT_INVGTN.ALERT_ID = TS_ALERT.ALERT_ID
LEFT JOIN
    TS_ALERT_CASE ON TS_ALERT_INVGTN.ALERT_INVSTN_ID = TS_ALERT_CASE.ALERT_INVSTN_ID
--JOIN
    --TS_CASE ON TS_ALERT_CASE.CASE_ID = TS_CASE.CASE_ID
LEFT JOIN
    TS_SAR_CASE ON TS_ALERT_CASE.CASE_ID = TS_SAR_CASE.CASE_ID
LEFT JOIN
    TS_SAR ON TS_SAR_CASE.SAR_ID = TS_SAR.SAR_ID
LEFT JOIN
    TS_STATUS ON TS_STATUS.STATUS_ID = TS_ALERT_INVGTN.STATUS_ID
                    WHERE
                    TS_ALERT_CUST.ACCT_ID IN ('1310064414')
                    AND TS_ALERT.CREATED_DATE >= '2024-04-19'
                
2024-10-19 16:53:16 - INFO - Successfully executed query: 
                                    SELECT TS_ALERT_CUST.ALERT_ID, TS_ALERT_CUST.CUST_ID, TS_ALERT_CUST.ACCT_ID , TS_ALERT.SCENARIO_ID
                                    FROM TS_ALERT_CUST
                                    INNER JOIN TS_ALERT ON TS_ALERT_CUST.ALERT_ID = TS_ALERT.ALERT_ID
                                                        
2024-10-19 16:53:16 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:20 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:26 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:33 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:41 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:46 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:51 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_4.parquet with scenario ID TS_SCN_30
2024-10-19 16:53:51 - INFO - Reading Parquet file: Parquet_Data/157/trxn_data_chunk_5.parquet
2024-10-19 16:53:51 - INFO - Fetched 2 transactions | Total unique customers: 124754
2024-10-19 16:53:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:51 - INFO - Importing AlertChecker class for scenario_id: TS_SCN_30
2024-10-19 16:53:51 - INFO - ALERTCHECKER initialized successfully.
2024-10-19 16:53:51 - INFO - Initializing AlertChecker for TS_SCN_30
2024-10-19 16:53:51 - INFO - Importing EvidenceReportGenerator class for scenario_id: TS_SCN_30
2024-10-19 16:53:51 - INFO - EvidenceReportGenerator initialized successfully.
2024-10-19 16:53:51 - INFO - No data found for lookback period
2024-10-19 16:53:51 - INFO - Successfully processed data with ALERTCHECKER. Total Alert - 0
2024-10-19 16:53:51 - INFO - No alerts generated!
2024-10-19 16:53:51 - INFO - Successfully processed Parquet file Parquet_Data/157/trxn_data_chunk_5.parquet with scenario ID TS_SCN_30
2024-10-19 16:53:51 - INFO - All data fetched: 915732 transactions | Total unique customers: 124754
2024-10-19 16:53:51 - INFO - Job ID - 157 |  Job Monitor Details Updated Successfully
2024-10-19 16:53:51 - INFO - Creating SQLAlchemy engine for database connection.
2024-10-19 16:53:57 - INFO - Job ID - 157 |  Job Details Updated Successfully
2024-10-19 16:53:57 - INFO - Pipeline execution completed successfully.
